<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DrivePlyr - Google Drive Video Player</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/SH20RAJ/DrivePlyr/main/Images/blue-player-logo-512x512.png">
    
    <!-- Artplayer JS Library -->
    <script src="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.js"></script>
    
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            background: #000;
        }
        
        .artplayer-app {
            width: 100vw;
            height: 100vh;
        }
        
        /* ব্যানার হাইড করার জন্য */
        .disclaimer, img[src*="000webhost"] { 
            display: none !important; 
        }
        
        /* লোডিং ইন্ডিকেটর */
        .loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 15px 30px;
            border-radius: 50px;
            font-family: Arial, sans-serif;
            z-index: 1000;
            display: none;
        }
        
        .loading-indicator.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="artplayer-app"></div>
    <div class="loading-indicator" id="loadingIndicator">ভিডিও লোড হচ্ছে...</div>

    <script>
        // লোডিং ইন্ডিকেটর
        const loadingIndicator = document.getElementById('loadingIndicator');
        
        // API Keys (র‍্যান্ডমভাবে একটি সিলেক্ট হবে)
        const apiKeys = [
            'AIzaSyCt3DULzE2trDJhfFUosWZT-3GEObbMqVU',
            'AIzaSyCsbx8BSyLwkw6XX6Lg5OF1U0HNtI9VmCY',
            'AIzaSyBLMJAT6oqTZxAMsCsMjXzoo4lkJL4MmfM',
            'AIzaSyCIY6fomcJxOt0XQ_naa1rzfd5wlOMGKDY'
        ];
        const apiKey = apiKeys[Math.floor(Math.random() * apiKeys.length)];
        console.log('Using API Key:', apiKey);

        // URL থেকে ID প্যারামিটার পড়া
        function getParam(name, url) {
            if (!url) url = window.location.href;
            return new URL(url).searchParams.get(name);
        }

        // ভিডিও ক্লিয়ার করার ফাংশন
        function getDriveVideoUrl() {
            const idParam = getParam('id');
            if (!idParam) return null;
            
            try {
                const json = JSON.parse(atob(idParam));
                const driveId = json.id;
                
                // Google Drive API থেকে ভিডিও লিংক তৈরি
                const videoUrl = `https://www.googleapis.com/drive/v3/files/${driveId}?alt=media&key=${apiKey}`;
                
                return {
                    url: videoUrl,
                    poster: `https://lh3.googleusercontent.com/d/${driveId}`,
                    id: driveId
                };
            } catch (error) {
                console.error('Error parsing video ID:', error);
                return null;
            }
        }

        // ভিডিও লোড করা
        function initPlayer() {
            loadingIndicator.classList.add('show');
            
            const videoData = getDriveVideoUrl();
            
            if (!videoData) {
                alert('ভিডিও আইডি পাওয়া যায়নি। URL এ ?id= প্যারামিটার যোগ করুন।');
                loadingIndicator.classList.remove('show');
                return;
            }

            console.log('Loading video from Google Drive:', videoData.id);

            // আর্টপ্লেয়ার ইনিশিয়ালাইজ
            var art = new Artplayer({
                container: '.artplayer-app',
                url: videoData.url,
                poster: videoData.poster,
                volume: 0.5,
                isLive: false,
                muted: false,
                autoplay: true,
                pip: true,
                autoSize: true,
                autoMini: true,
                screenshot: true,
                setting: true,
                loop: false,
                flip: true,
                playbackRate: true,
                aspectRatio: true,
                fullscreen: true,
                fullscreenWeb: true,
                subtitleOffset: true,
                miniProgressBar: true,
                mutex: true,
                backdrop: true,
                playsInline: true,
                autoPlayback: true,
                airplay: true,
                theme: '#23ade5',
                lang: 'en',
                moreVideoAttr: {
                    crossOrigin: 'anonymous',
                },
                
                // কোয়ালিটি সেটিংস
                quality: [
                    {
                        default: true,
                        html: 'Auto',
                        url: videoData.url,
                    }
                ],

                // কাস্টম সেটিংস মেনু
                settings: [
                    {
                        width: 200,
                        html: 'Playback Speed',
                        icon: '<img width="22" height="22" src="https://artplayer.org/assets/img/state.svg">',
                        tooltip: '1x',
                        range: [1, 0.25, 2, 0.25],
                        onRange(item) {
                            art.playbackRate = item.range[0];
                            return `${item.range[0]}x`;
                        },
                    },
                ],

                // রাইট ক্লিক মেনু
                contextmenu: [
                    {
                        html: 'DrivePlyr Custom Menu',
                        click(contextmenu) {
                            contextmenu.show = false;
                        },
                    },
                ],

                // লেয়ার বা লোগো
                layers: [
                    {
                        html: '<img width="60" src="https://raw.githubusercontent.com/SH20RAJ/DrivePlyr/main/Images/blue-player-logo-512x512.png" style="opacity: 0.7">',
                        click() {
                            console.info('Logo Clicked');
                        },
                        style: {
                            position: 'absolute',
                            top: '20px',
                            right: '20px',
                        },
                    },
                ],

                // কাস্টম কন্ট্রোল বাটন
                controls: [
                    {
                        position: 'right',
                        html: 'DrivePlyr',
                        index: 1,
                        tooltip: 'Google Drive Video Player',
                        style: { marginRight: '20px' },
                        click() {
                            window.open('https://github.com/SH20RAJ/DrivePlyr', '_blank');
                        },
                    },
                ],

                // আইকন সেটিংস
                icons: {
                    loading: '<img src="https://artplayer.org/assets/img/ploading.gif">',
                    state: '<img width="100" height="100" src="https://artplayer.org/assets/img/state.svg">',
                    indicator: '<img width="16" height="16" src="https://artplayer.org/assets/img/indicator.svg">',
                },
            });

            // প্লেয়ার রেডি হলে
            art.on('ready', () => {
                loadingIndicator.classList.remove('show');
                console.info('DrivePlyr loaded with Google Drive video!');
            });

            // এরর হ্যান্ডলিং
            art.on('error', (error) => {
                loadingIndicator.classList.remove('show');
                console.error('Player error:', error);
                alert('ভিডিও লোড করতে সমস্যা হয়েছে।');
            });

            // কী-বোর্ড শর্টকাট (স্পেস বার = প্লে/পজ)
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space') {
                    e.preventDefault();
                    art.toggle();
                }
                if (e.code === 'ArrowLeft') {
                    art.seek = art.currentTime - 10;
                }
                if (e.code === 'ArrowRight') {
                    art.seek = art.currentTime + 10;
                }
                if (e.code === 'KeyM') {
                    art.muted = !art.muted;
                }
                if (e.code === 'KeyF') {
                    art.fullscreen = !art.fullscreen;
                }
            });

            return art;
        }

        // পেজ লোড হওয়ার পর প্লেয়ার ইনিশিয়ালাইজ
        window.addEventListener('DOMContentLoaded', initPlayer);
    </script>
</body>
</html>
