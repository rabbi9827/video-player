<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://raw.githubusercontent.com/SH20RAJ/DrivePlyr/main/drive-logo.png">
    <title>DrivePlyr - Google Drive Proxy Video Player with Many Powerful HTML5 Players</title>
    
    <!-- Meta Tags for SEO -->
    <meta name="description" content="DrivePlyr is a Google Drive Proxy Video Player with Many Powerful HTML5 Players, Hidden ID, and Many Features. Play your videos from Google Drive with ease.">
    <meta name="keywords" content="DrivePlyr, Google Drive, Proxy, Video Player, HTML5 Player, Hidden ID, Features">
    <meta name="author" content="RTube">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://rabbi9827.github.io/video-player/">
    <meta property="og:title" content="DrivePlyr - Google Drive Proxy Video Player with Many Powerful HTML5 Players">
    <meta property="og:description" content="DrivePlyr is a Google Drive Proxy Video Player with Many Powerful HTML5 Players, Hidden ID, and Many Features. Play your videos from Google Drive with ease.">
    <meta property="og:image" content="https://sh20raj.github.io/DrivePlyr/drive-logo.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://rabbi9827.github.io/video-player/">
    <meta property="twitter:title" content="DrivePlyr - Google Drive Proxy Video Player with Many Powerful HTML5 Players">
    <meta property="twitter:description" content="DrivePlyr is a Google Drive Proxy Video Player with Many Powerful HTML5 Players, Hidden ID, and Many Features. Play your videos from Google Drive with ease.">
    <meta property="twitter:image" content="https://sh20raj.github.io/DrivePlyr/drive-logo.png">

    <!-- Other Meta Tags -->
    <meta name="theme-color" content="#002333">
    <meta name="robots" content="index, follow">

    <!-- Google Fonts & Material Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Symbols+Outlined" rel="stylesheet">

    <style>
        @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap");

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Poppins", sans-serif;
        }

        video::cue {
            opacity: 0;
        }

        .caption_text {
            position: absolute;
            left: 50%;
            bottom: 10%;
            width: 90%;
            max-width: 90%;
            transform: translate(-50%, -50%);
            text-align: center;
            user-select: none;
            transition: bottom 0.3s;
            z-index: 10;
        }

        .caption_text.active {
            bottom: 0%;
        }

        .caption_text mark {
            background-color: #0000008f !important;
            color: #fff;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .material-icons {
            user-select: none;
            -webkit-user-select: none;
            cursor: pointer;
        }

        body {
            background-color: #002333;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .video_player {
            position: relative;
            width: 100%;
            height: 100vh;
            max-width: 100%;
            background: #000;
            overflow: hidden;
        }

        /* Central play button - নতুন স্টাইল */
        .central-play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 15;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            border: none;
            background: transparent;
            padding: 0;
            margin: 0;
            outline: none;
        }

        .central-play-button.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .central-play-button .material-icons {
            font-size: 70px;
            color: rgba(255, 255, 255, 0.85);
            text-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
            transition: all 0.2s ease;
            border-radius: 0;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        .central-play-button:active .material-icons {
            transform: scale(0.95);
            color: rgba(255, 255, 255, 0.95);
        }

        /* Loader - ঠিক প্লে বাটনের জায়গায় */
        .video_player .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            z-index: 15;
            display: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .video_player .loader::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: rotate 1s linear infinite;
        }

        @keyframes rotate {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .video_player .main-video {
            position: relative;
            width: 100%;
            height: 100%;
            outline: none;
            object-fit: contain;
        }

        .video_player .progressAreaTime {
            position: absolute;
            left: calc(var(--x) + 11px);
            transform: translateX(-50%);
            bottom: 60px;
            min-width: 60px;
            text-align: center;
            white-space: nowrap;
            padding: 5px 10px;
            color: #fff;
            font-size: 14px;
            font-weight: 400;
            z-index: 15;
            display: none;
            background: rgba(0,0,0,0.7);
            border-radius: 4px;
            pointer-events: none;
        }

        .video_player .controls {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 50px;
            width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            z-index: 10;
            transform: translateY(100%);
            transition: 0.3s;
            padding: 0px 10px;
            opacity: 1;
        }

        .video_player .controls.active {
            transform: translateY(0);
            opacity: 1;
        }

        .video_player .controls .progress-area {
            width: 100%;
            height: 5px;
            margin: auto;
            background: rgba(255,255,255,0.3);
            cursor: pointer;
            position: relative;
            border-radius: 3px;
            transition: height 0.1s ease;
        }

        .video_player .controls .progress-area:hover {
            height: 7px;
        }

        .video_player .controls .progress-area.dragging {
            height: 7px;
        }

        .controls .progress-area .progress-bar {
            position: relative;
            width: 0%;
            background: linear-gradient(to right, #ffae00, #ff8c00);
            height: inherit;
            border-radius: inherit;
            cursor: pointer;
            transition: width 0.1s ease;
        }

        .controls .progress-area .progress-bar::before {
            content: "";
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
            background: #ffae00;
            box-shadow: 0 0 5px rgba(255,174,0,0.5);
            opacity: 0;
            transition: all 0.15s ease-out;
        }

        .controls .progress-area:hover .progress-bar::before,
        .controls .progress-area.dragging .progress-bar::before {
            opacity: 1;
            transform: translateY(-50%) scale(1);
            box-shadow: 0 0 10px rgba(255,174,0,0.8);
        }

        .controls .progress-area .bufferedBar {
            position: absolute;
            top: 0%;
            left: 0%;
            width: 100%;
            height: inherit;
            border-radius: inherit;
        }

        .controls .controls-list {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: nowrap;
            width: 97%;
            height: 46px;
            margin: 0 auto;
        }

        .controls .controls-list .controls-left,
        .controls .controls-list .controls-right {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .controls .controls-left .timer {
            display: inline-block;
            font-size: 14px;
            white-space: nowrap;
            color: #fff;
            margin-left: 5px;
            text-align: center;
        }

        .controls .icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: #fff;
            margin-left: 8px;
            margin-right: 5px;
        }

        .controls .icon .material-icons {
            font-size: 26px;
            color: #fff;
            cursor: pointer;
            transition: color 0.2s;
            -webkit-tap-highlight-color: transparent;
        }

        .controls .icon .material-icons:hover {
            color: #ffae00;
        }

        .controls .icon .material-icons.fast-rewind:active {
            transition: 0.2s;
            transform: rotate(-45deg);
        }

        .controls .icon .material-icons.fast-forward:active {
            transition: 0.2s;
            transform: rotate(45deg);
        }

        .controls .icon .volume_range {
            -webkit-appearance: none;
            appearance: none;
            width: 0px;
            height: 3px;
            background: #fff;
            cursor: pointer;
            outline: none;
            border: none;
            transition: 0.4s;
            border-radius: 3px;
        }

        .controls .icon .volume_range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ffae00;
            opacity: 0;
            transition: 0.3s;
        }

        .controls .icon:hover .volume_range {
            display: inline-block;
            width: 60px;
        }

        .controls .icon:hover .volume_range::-webkit-slider-thumb {
            opacity: 1;
        }

        /* Adjusted button sizes - Settings and Picture in Picture smaller, Fullscreen larger */
        .controls-right .icon .material-icons.settingsBtn {
            font-size: 22px;
            transition: 0.3s;
        }

        .controls-right .icon .material-icons.picture_in_picutre {
            font-size: 22px;
            transition: 0.3s;
        }

        .controls-right .icon .material-icons.fullscreen {
            font-size: 28px;
            transition: 0.3s;
        }

        .controls-right .icon .settingsBtn.active {
            transform: rotate(45deg);
            color: #ffae00;
        }

        .video_player .settings {
            position: absolute;
            right: 10px;
            bottom: 62px;
            background: rgba(28, 28, 28, 0.95);
            width: 200px;
            max-height: 300px;
            height: auto;
            color: #fff;
            overflow-y: auto;
            z-index: 20;
            display: none;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .video_player .settings.active {
            display: block;
        }

        .video_player .settings > div > span {
            font-size: 14px;
            font-weight: 500;
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            white-space: nowrap;
        }

        .video_player .settings > div .icon {
            font-size: 14px;
            margin: 0 5px;
            cursor: pointer;
        }

        .video_player .settings > div ul {
            position: relative;
            list-style: none;
        }

        .video_player .settings > div ul li {
            position: relative;
            width: 100%;
            cursor: pointer;
            text-align: left;
            padding: 10px 20px 10px 35px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            transition: background 0.2s;
        }

        .video_player .settings > div ul li:hover {
            background: rgba(255,174,0,0.15);
        }

        .video_player .settings > div ul li.active::before {
            content: "\e876";
            font-family: "Material Icons";
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            color: #ffae00;
        }

        .video_player .settings::-webkit-scrollbar {
            width: 6px;
            background: transparent;
        }

        .video_player .settings::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }

        /* YouTube-style preview thumbnail */
        .preview-thumbnail {
            position: absolute;
            bottom: 70px;
            left: var(--preview-x, 0px);
            transform: translateX(-50%);
            width: 160px;
            height: 90px;
            background: #000;
            border-radius: 4px;
            overflow: hidden;
            display: none;
            z-index: 30;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            pointer-events: none;
        }

        .preview-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-thumbnail .preview-time {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            color: #fff;
            font-size: 12px;
            padding: 4px;
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .video_player {
                width: 100%;
                border-radius: 0;
            }
            
            .preview-thumbnail {
                display: none !important;
            }
            
            .central-play-button .material-icons {
                font-size: 65px;
            }
            
            .video_player .loader,
            .video_player .loader::before {
                width: 65px;
                height: 65px;
            }
        }

        @media (max-width: 430px) {
            .controls .icon {
                margin-left: 3px;
                margin-right: 3px;
            }
            
            .controls .icon .material-icons {
                font-size: 22px;
            }

            .volume_range {
                display: none !important;
            }
            
            .controls .controls-left .timer {
                font-size: 12px;
            }
            
            /* Mobile devices এ সব বাটন দেখাবে */
            .volume, .picture_in_picutre {
                display: inline-flex !important;
            }
            
            .central-play-button .material-icons {
                font-size: 60px;
            }
            
            .video_player .loader,
            .video_player .loader::before {
                width: 60px;
                height: 60px;
            }
        }

        /* Smooth transition classes */
        .video_player.smooth-seeking .progress-bar {
            transition: width 0.05s ease;
        }
    </style>
</head>
<body>
    <div class="video_player">
        <div class="loader"></div>
        <video class="main-video" id="main-video" preload="metadata"></video>
        
        <!-- Central play button -->
        <div class="central-play-button">
            <i class="material-icons">play_arrow</i>
        </div>
        
        <p class="caption_text"></p>
        <div class="progressAreaTime">0:00</div>
        
        <!-- Preview thumbnail (YouTube-style) -->
        <div class="preview-thumbnail">
            <img id="preview-img" src="/placeholder.svg" alt="Preview">
            <div class="preview-time">0:00</div>
        </div>
        
        <div class="controls active">
            <div class="progress-area">
                <canvas class="bufferedBar"></canvas>
                <div class="progress-bar"><span></span></div>
            </div>

            <div class="controls-list">
                <div class="controls-left">
                    <span class="icon">
                        <i class="material-icons fast-rewind">replay_10</i>
                    </span>
                    <span class="icon">
                        <i class="material-icons play_pause">play_arrow</i>
                    </span>
                    <span class="icon">
                        <i class="material-icons fast-forward">forward_10</i>
                    </span>
                    <span class="icon">
                        <i class="material-icons volume">volume_up</i>
                        <input type="range" min="0" max="100" value="100" class="volume_range" />
                    </span>
                    <div class="timer">
                        <span class="current">0:00</span> / <span class="duration">0:00</span>
                    </div>
                </div>

                <div class="controls-right">
                    <span class="icon">
                        <i class="material-icons settingsBtn">settings</i>
                    </span>
                    <span class="icon">
                        <i class="material-icons picture_in_picutre">picture_in_picture_alt</i>
                    </span>
                    <span class="icon">
                        <i class="material-icons fullscreen">fullscreen</i>
                    </span>
                </div>
            </div>
        </div>

        <div class="settings">
            <div data-label="settingHome">
                <ul>
                    <li data-label="speed">
                        <span>Speed</span>
                        <span class="material-symbols-outlined icon">arrow_forward_ios</span>
                    </li>
                </ul>
            </div>
            <div class="playback" data-label="speed" hidden>
                <span>
                    <i class="material-symbols-outlined icon back_arrow" data-label="settingHome">arrow_back</i>
                    <span>Playback Speed</span>
                </span>
                <ul>
                    <li data-speed="0.25">0.25x</li>
                    <li data-speed="0.5">0.5x</li>
                    <li data-speed="0.75">0.75x</li>
                    <li data-speed="1" class="active">Normal</li>
                    <li data-speed="1.25">1.25x</li>
                    <li data-speed="1.5">1.5x</li>
                    <li data-speed="1.75">1.75x</li>
                    <li data-speed="2">2x</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Google API Keys
        var apikeys = [
            'AIzaSyCt3DULzE2trDJhfFUosWZT-3GEObbMqVU',
            'AIzaSyCsbx8BSyLwkw6XX6Lg5OF1U0HNtI9VmCY',
            'AIzaSyATjR8DbYGha0Z2U84gPVT0dxROp7UdWy8',
            'AIzaSyBLMJAT6oqTZxAMsCsMjXzoo4lkJL4MmfM',
            'AIzaSyCIY6fomcJxOt0XQ_naa1rzfd5wlOMGKDY',
            'AIzaSyDCLkAwFkagtt077kgXw1HfmYGx-VLkvt8'
        ];
        var apikey = apikeys[Math.floor(Math.random() * apikeys.length)];

        function getparam(a, e) {
            return e || (e = window.location.href), new URL(e).searchParams.get(a);
        }

        // Elements
        const video_player = document.querySelector('.video_player');
        const mainVideo = document.getElementById('main-video');
        const progressAreaTime = document.querySelector('.progressAreaTime');
        const controls = document.querySelector('.controls');
        const progressArea = document.querySelector('.progress-area');
        const bufferedBar = document.querySelector('.bufferedBar');
        const progress_Bar = document.querySelector('.progress-bar');
        const fast_rewind = document.querySelector('.fast-rewind');
        const play_pause = document.querySelector('.play_pause');
        const fast_forward = document.querySelector('.fast-forward');
        const volume = document.querySelector('.volume');
        const volume_range = document.querySelector('.volume_range');
        const current = document.querySelector('.current');
        const totalDuration = document.querySelector('.duration');
        const settingsBtn = document.querySelector('.settingsBtn');
        const picture_in_picutre = document.querySelector('.picture_in_picutre');
        const fullscreen = document.querySelector('.fullscreen');
        const settings = document.querySelector('.settings');
        const settingHome = document.querySelectorAll(".settings [data-label='settingHome'] > ul > li");
        const playback = document.querySelectorAll('.playback li');
        const loader = document.querySelector('.loader');
        const settingDivs = document.querySelectorAll('.settings > div');
        const settingBack = document.querySelectorAll('.settings > div .back_arrow');
        const previewThumbnail = document.querySelector('.preview-thumbnail');
        const previewImg = document.getElementById('preview-img');
        const previewTime = document.querySelector('.preview-time');
        
        // New elements
        const centralPlayBtn = document.querySelector('.central-play-button');
        const centralPlayIcon = centralPlayBtn.querySelector('.material-icons');

        let controlsVisible = true;
        let hideControlsTimer = null;
        const HIDE_DELAY = 3000; // 3 seconds

        // Smooth seeking variables
        let isDragging = false;
        let wasPlaying = false;
        let smoothSeekTimeout = null;
        let lastUpdateTime = 0;
        const UPDATE_INTERVAL = 50;

        // Load video from Google Drive
        if (getparam('id')) {
            try {
                let json = JSON.parse(atob(getparam('id')));
                let driveid = json.id;
                mainVideo.src = `https://www.googleapis.com/drive/v3/files/${driveid}?alt=media&key=${apikey}`;
                mainVideo.poster = 'https://lh3.googleusercontent.com/d/' + driveid;
            } catch (e) {
                console.error('Invalid video ID');
                mainVideo.src = 'https://bit.ly/bbsamplevideo';
            }
        } else {
            mainVideo.src = 'https://bit.ly/bbsamplevideo';
        }

        // Loader management functions
        function showLoader() {
            centralPlayBtn.classList.add('hidden');
            loader.style.display = 'block';
            setTimeout(() => {
                loader.style.opacity = '1';
            }, 10);
        }

        function hideLoader() {
            loader.style.opacity = '0';
            setTimeout(() => {
                loader.style.display = 'none';
                if (!mainVideo.paused || mainVideo.currentTime === 0) {
                    centralPlayBtn.classList.remove('hidden');
                }
            }, 300);
        }

        function showControls() {
            controlsVisible = true;
            controls.classList.add('active');
            if (!loader.style.display || loader.style.display === 'none') {
                centralPlayBtn.classList.remove('hidden');
            }
            resetHideTimer();
        }

        function hideControls() {
            if (!mainVideo.paused && !settings.classList.contains('active')) {
                controlsVisible = false;
                controls.classList.remove('active');
                if (!loader.style.display || loader.style.display === 'none') {
                    centralPlayBtn.classList.add('hidden');
                }
                settings.classList.remove('active');
                settingsBtn.classList.remove('active');
            }
        }

        function resetHideTimer() {
            clearTimeout(hideControlsTimer);
            if (!mainVideo.paused) {
                hideControlsTimer = setTimeout(hideControls, HIDE_DELAY);
            }
        }

        function toggleControls() {
            if (controlsVisible) {
                // Force hide even if video is paused for toggle
                controlsVisible = false;
                controls.classList.remove('active');
                if (!loader.style.display || loader.style.display === 'none') {
                    centralPlayBtn.classList.add('hidden');
                }
                settings.classList.remove('active');
                settingsBtn.classList.remove('active');
                clearTimeout(hideControlsTimer);
            } else {
                showControls();
            }
        }

        // Central play button functions
        function updateCentralPlayButton() {
            if (mainVideo.paused) {
                centralPlayIcon.textContent = 'play_arrow';
            } else {
                centralPlayIcon.textContent = 'pause';
            }
        }

        // Play/Pause
        function playVideo() {
            play_pause.innerHTML = 'pause';
            play_pause.title = 'Pause';
            centralPlayIcon.innerHTML = 'pause';
            video_player.classList.add('paused');
            mainVideo.play();
            resetHideTimer();
        }

        function pauseVideo() {
            play_pause.innerHTML = 'play_arrow';
            play_pause.title = 'Play';
            centralPlayIcon.innerHTML = 'play_arrow';
            video_player.classList.remove('paused');
            mainVideo.pause();
            clearTimeout(hideControlsTimer);
        }

        play_pause.addEventListener('click', (e) => {
            e.stopPropagation();
            video_player.classList.contains('paused') ? pauseVideo() : playVideo();
        });

        mainVideo.addEventListener('play', () => {
            play_pause.innerHTML = 'pause';
            play_pause.title = 'Pause';
            centralPlayIcon.innerHTML = 'pause';
            video_player.classList.add('paused');
            resetHideTimer();
        });

        mainVideo.addEventListener('pause', () => {
            play_pause.innerHTML = 'play_arrow';
            play_pause.title = 'Play';
            centralPlayIcon.innerHTML = 'play_arrow';
            video_player.classList.remove('paused');
            clearTimeout(hideControlsTimer);
        });

        // Central play button click
        centralPlayBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            video_player.classList.contains('paused') ? pauseVideo() : playVideo();
        });

        // Fast rewind/forward
        fast_rewind.addEventListener('click', (e) => { 
            e.stopPropagation();
            mainVideo.currentTime -= 10; 
            resetHideTimer();
        });
        
        fast_forward.addEventListener('click', (e) => { 
            e.stopPropagation();
            mainVideo.currentTime += 10; 
            resetHideTimer();
        });

        // Duration
        mainVideo.addEventListener('loadeddata', (e) => {
            const duration = e.target.duration;
            const min = Math.floor(duration / 60);
            let sec = Math.floor(duration % 60);
            sec = sec < 10 ? '0' + sec : sec;
            totalDuration.innerHTML = `${min}:${sec}`;
        });

        // Time update
        mainVideo.addEventListener('timeupdate', (e) => {
            if (isDragging) return;
            
            const currentTime = Date.now();
            if (currentTime - lastUpdateTime < UPDATE_INTERVAL) return;
            lastUpdateTime = currentTime;
            
            const videoCurrentTime = e.target.currentTime;
            const duration = e.target.duration;
            
            const min = Math.floor(videoCurrentTime / 60);
            let sec = Math.floor(videoCurrentTime % 60);
            sec = sec < 10 ? '0' + sec : sec;
            current.innerHTML = `${min}:${sec}`;
            
            const progressWidth = (videoCurrentTime / duration) * 100;
            requestAnimationFrame(() => {
                progress_Bar.style.width = `${progressWidth}%`;
            });
        });

        // Buffered bar
        function drawProgress(canvas, buffered, duration) {
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'rgba(255,255,255,0.4)';
            const height = canvas.height;
            const width = canvas.width;
            ctx.clearRect(0, 0, width, height);
            for (let i = 0; i < buffered.length; i++) {
                const start = (buffered.start(i) / duration) * width;
                const end = (buffered.end(i) / duration) * width;
                ctx.fillRect(start, 0, end - start, height);
            }
        }

        mainVideo.addEventListener('progress', () => {
            if (mainVideo.duration) {
                drawProgress(bufferedBar, mainVideo.buffered, mainVideo.duration);
            }
        });

        // Loader events
        mainVideo.addEventListener('waiting', () => { 
            showLoader();
            video_player.classList.add('smooth-seeking');
        });
        
        mainVideo.addEventListener('canplay', () => { 
            hideLoader();
            video_player.classList.remove('smooth-seeking');
        });

        mainVideo.addEventListener('seeking', () => {
            if (!mainVideo.paused) {
                showLoader();
            }
        });

        mainVideo.addEventListener('seeked', () => {
            hideLoader();
        });

        // Volume
        function changeVolume() {
            mainVideo.volume = volume_range.value / 100;
            if (volume_range.value == 0) {
                volume.innerHTML = 'volume_off';
            } else if (volume_range.value < 40) {
                volume.innerHTML = 'volume_down';
            } else {
                volume.innerHTML = 'volume_up';
            }
        }

        volume_range.addEventListener('input', changeVolume);
        volume.addEventListener('click', (e) => {
            e.stopPropagation();
            if (volume_range.value == 0) {
                volume_range.value = 80;
                mainVideo.volume = 0.8;
                volume.innerHTML = 'volume_up';
            } else {
                volume_range.value = 0;
                mainVideo.volume = 0;
                volume.innerHTML = 'volume_off';
            }
        });

        // Progress area time display
        progressArea.addEventListener('mousemove', (e) => {
            if (!mainVideo.duration) return;
            
            const width = progressArea.clientWidth;
            const rect = progressArea.getBoundingClientRect();
            let x = e.clientX - rect.left;
            x = Math.max(0, Math.min(x, width));
            
            const time = (x / width) * mainVideo.duration;
            const min = Math.floor(time / 60);
            let sec = Math.floor(time % 60);
            sec = sec < 10 ? '0' + sec : sec;
            
            progressAreaTime.style.setProperty('--x', `${x}px`);
            progressAreaTime.style.display = 'block';
            progressAreaTime.innerHTML = `${min}:${sec}`;
            
            if (!isDragging) {
                previewThumbnail.style.setProperty('--preview-x', `${x}px`);
                previewThumbnail.style.display = 'block';
                previewTime.textContent = `${min}:${sec}`;
                previewImg.src = mainVideo.poster || 'https://via.placeholder.com/160x90/333/fff?text=Preview';
            }
        });

        progressArea.addEventListener('mouseleave', () => {
            if (!isDragging) {
                progressAreaTime.style.display = 'none';
                previewThumbnail.style.display = 'none';
            }
        });

        // Picture in Picture
        picture_in_picutre.addEventListener('click', (e) => {
            e.stopPropagation();
            if (document.pictureInPictureElement) {
                document.exitPictureInPicture();
            } else {
                mainVideo.requestPictureInPicture();
            }
        });

        // Fullscreen
        fullscreen.addEventListener('click', (e) => {
            e.stopPropagation();
            if (!document.fullscreenElement) {
                video_player.classList.add('openFullScreen');
                fullscreen.innerHTML = 'fullscreen_exit';
                video_player.requestFullscreen();
            } else {
                video_player.classList.remove('openFullScreen');
                fullscreen.innerHTML = 'fullscreen';
                document.exitFullscreen();
            }
        });

        // Settings
        settingsBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            settings.classList.toggle('active');
            settingsBtn.classList.toggle('active');
            if (settings.classList.contains('active')) {
                clearTimeout(hideControlsTimer);
            } else {
                resetHideTimer();
            }
        });

        // Playback speed
        playback.forEach((item) => {
            item.addEventListener('click', (e) => {
                e.stopPropagation();
                playback.forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                mainVideo.playbackRate = item.getAttribute('data-speed');
            });
        });

        // Settings navigation
        settingBack.forEach((item) => {
            item.addEventListener('click', (e) => {
                e.stopPropagation();
                const label = e.target.getAttribute('data-label');
                settingDivs.forEach(div => {
                    div.getAttribute('data-label') === label ? div.removeAttribute('hidden') : div.setAttribute('hidden', '');
                });
            });
        });

        settingHome.forEach((item) => {
            item.addEventListener('click', (e) => {
                e.stopPropagation();
                const label = e.target.getAttribute('data-label');
                settingDivs.forEach(div => {
                    div.getAttribute('data-label') === label ? div.removeAttribute('hidden') : div.setAttribute('hidden', '');
                });
            });
        });

        let clickCount = 0;
        let clickTimer = null;

        video_player.addEventListener('click', (e) => {
            // Don't trigger if clicking on controls or settings
            if (e.target.closest('.controls') || 
                e.target.closest('.settings') || 
                e.target.closest('.central-play-button')) {
                return;
            }
            
            clickCount++;
            
            if (clickCount === 1) {
                clickTimer = setTimeout(() => {
                    // Single click - toggle controls
                    toggleControls();
                    clickCount = 0;
                }, 250);
            } else if (clickCount === 2) {
                // Double click - fullscreen
                clearTimeout(clickTimer);
                clickCount = 0;
                fullscreen.click();
            }
        });

        // Prevent right-click
        mainVideo.addEventListener('contextmenu', (e) => e.preventDefault());

        // Auto-rotate for fullscreen
        function rotateToLandscape() {
            if (screen.orientation && screen.orientation.lock) {
                screen.orientation.lock('landscape-primary').catch(() => {});
            }
        }

        function unlockOrientation() {
            if (screen.orientation && screen.orientation.unlock) {
                screen.orientation.unlock();
            }
        }

        document.addEventListener('fullscreenchange', () => {
            const isFullscreen = document.fullscreenElement;
            if (isFullscreen) {
                video_player.classList.add('openFullScreen');
                fullscreen.innerHTML = 'fullscreen_exit';
                setTimeout(rotateToLandscape, 100);
            } else {
                video_player.classList.remove('openFullScreen');
                fullscreen.innerHTML = 'fullscreen';
                setTimeout(unlockOrientation, 100);
                showControls();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                case 'k':
                    e.preventDefault();
                    video_player.classList.contains('paused') ? pauseVideo() : playVideo();
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    mainVideo.currentTime -= 5;
                    showControls();
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    mainVideo.currentTime += 5;
                    showControls();
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    mainVideo.volume = Math.min(1, mainVideo.volume + 0.1);
                    volume_range.value = mainVideo.volume * 100;
                    changeVolume();
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    mainVideo.volume = Math.max(0, mainVideo.volume - 0.1);
                    volume_range.value = mainVideo.volume * 100;
                    changeVolume();
                    break;
                case 'f':
                    fullscreen.click();
                    break;
                case 'm':
                    volume.click();
                    break;
                case 'c':
                    const tracks = mainVideo.textTracks;
                    if (tracks.length > 0) {
                        for (let i = 0; i < tracks.length; i++) {
                            tracks[i].mode = tracks[i].mode === 'showing' ? 'hidden' : 'showing';
                        }
                    }
                    break;
            }
        });

        // Progress bar drag
        progressArea.addEventListener('mousedown', startDrag);
        progressArea.addEventListener('touchstart', startDrag, { passive: false });

        function startDrag(e) {
            e.preventDefault();
            e.stopPropagation();
            
            wasPlaying = !mainVideo.paused;
            isDragging = true;
            progressArea.classList.add('dragging');
            video_player.classList.add('smooth-seeking');
            
            if (wasPlaying) {
                mainVideo.pause();
                showLoader();
            }
            
            updateProgress(e);
            
            document.addEventListener('mousemove', updateProgress);
            document.addEventListener('touchmove', updateProgress, { passive: false });
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
        }

        function updateProgress(e) {
            if (!isDragging || !mainVideo.duration) return;
            
            const width = progressArea.clientWidth;
            const rect = progressArea.getBoundingClientRect();
            
            let clientX;
            if (e.type.includes('touch')) {
                clientX = e.touches[0].clientX;
            } else {
                clientX = e.clientX;
            }
            
            let clickX = clientX - rect.left;
            clickX = Math.max(0, Math.min(clickX, width));
            
            const progressPercent = (clickX / width) * 100;
            const newTime = (clickX / width) * mainVideo.duration;
            
            requestAnimationFrame(() => {
                progress_Bar.style.width = `${progressPercent}%`;
            });
            
            if (!smoothSeekTimeout) {
                smoothSeekTimeout = setTimeout(() => {
                    mainVideo.currentTime = newTime;
                    smoothSeekTimeout = null;
                }, 16);
            }
            
            const min = Math.floor(newTime / 60);
            let sec = Math.floor(newTime % 60);
            sec = sec < 10 ? '0' + sec : sec;
            current.innerHTML = `${min}:${sec}`;
            
            progressAreaTime.style.setProperty('--x', `${clickX}px`);
            progressAreaTime.style.display = 'block';
            progressAreaTime.innerHTML = `${min}:${sec}`;
            
            previewThumbnail.style.display = 'none';
        }

        function endDrag(e) {
            if (!isDragging) return;
            
            isDragging = false;
            progressArea.classList.remove('dragging');
            progressAreaTime.style.display = 'none';
            previewThumbnail.style.display = 'none';
            
            document.removeEventListener('mousemove', updateProgress);
            document.removeEventListener('touchmove', updateProgress);
            document.removeEventListener('mouseup', endDrag);
            document.removeEventListener('touchend', endDrag);
            
            if (smoothSeekTimeout) {
                clearTimeout(smoothSeekTimeout);
                smoothSeekTimeout = null;
            }
            
            const width = progressArea.clientWidth;
            const rect = progressArea.getBoundingClientRect();
            let clientX;
            
            if (e.type.includes('touch')) {
                clientX = e.changedTouches[0].clientX;
            } else {
                clientX = e.clientX;
            }
            
            let clickX = clientX - rect.left;
            clickX = Math.max(0, Math.min(clickX, width));
            const newTime = (clickX / width) * mainVideo.duration;
            
            mainVideo.currentTime = newTime;
            
            if (wasPlaying) {
                setTimeout(() => {
                    mainVideo.play();
                    video_player.classList.remove('smooth-seeking');
                }, 100);
            } else {
                hideLoader();
                video_player.classList.remove('smooth-seeking');
            }
            
            resetHideTimer();
        }

        // Click to seek on progress bar
        progressArea.addEventListener('click', (e) => {
            e.stopPropagation();
            if (isDragging) return;
            
            const width = progressArea.clientWidth;
            const rect = progressArea.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            mainVideo.currentTime = (clickX / width) * mainVideo.duration;
            resetHideTimer();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            const resizeCanvas = () => {
                bufferedBar.width = progressArea.clientWidth;
                bufferedBar.height = progressArea.clientHeight;
            };
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            updateCentralPlayButton();
            
            // Hide loader initially
            loader.style.opacity = '0';
            loader.style.display = 'none';
        });
    </script>
</body>
</html>
